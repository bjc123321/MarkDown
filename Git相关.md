# **Git使用**

## 1.基本语法

1. **克隆仓库**：git clone <URL> 下载代码（用命令最好，因为会把.git一起clone下来方便后续上传代码。.git 目录是 Git 版本控制系统的核心，它包含了所有与仓库相关的元数据和对象。简而言之，.git 目录使你的项目成为一个 Git 仓库，并且存储了所有历史记录、配置和当前状态信息）
2. **创建但不会切换到新分支**：git branch <分支名>
3. **创建并切换新分支**：git checkout -b <分支名> 创建并切换到新分支。
4. **切换分支(新版本git推荐)**：git switch <分支名> 专门用于分支切换操作，语义更清晰
5. **查看分支**：git branch -a
6. **删除本地分支**：git branch -d <分支名>
7. **添加更改**：git add . 添加更改到暂存区。
8. **提交更改**：git commit -m "描述提交" 提交到本地仓库。
9. **推送更改**：git push origin <分支名> 上传到远程仓库。
10. **拉取最新更改**：git pull 获取最新的远程更改。
11. **合并分支**：git merge <分支名> 合并分支到当前分支
12. **查看工作目录和暂存区的差异：**git diff 
13. **查看暂存区和上一次提交的差异：**git diff --staged
14. **查看哪些文件已被添加到暂存区，哪些文件仍处于未暂存状态：**git status
15. **查看哪些文件被git跟踪**：git ls-files

 

------

##  2.常见问题

1. Git在clone代码或者push到远端时出现的一些网络延时或者无法连接的问题（对于github来说很常见）：

2. 首先，**挂梯子**。

3. 在git bash下配置代理。注意要windows设置界面的“代理”，确保地址和端口保持一致。（***注：当更换梯子时也要相应的配置更换后的代理服务器端口号***）

4. 查看当前例如，在git bash中输入下面两行设置代理的命令。（红色部分要注意与设置界面的保持一致）

   ```shell
   git config --global http.proxy http://127.0.0.1:33210
   git config --global https.proxy http://127.0.0.1:33210
   ```

<img src=".\images\winAgent.png" style="zoom: 80%;" />

# **Git 撤回操作指南**

在使用 Git 提交代码时，如果发现错误或需要撤回之前的操作，可以使用以下方法进行撤回。根据具体情况选择适合的方法。

## **1. 撤回尚未提交的更改**

### **a. 撤回工作区的所有更改**

撤回所有尚未添加到暂存区（即 git add 之前）的更改：

```shell
git  checkout -- .
```

或指定特定文件：

```shell
git checkout -- <file>
```

### **b. 撤回暂存区的更改**

撤回已经使用 git add 添加到暂存区的文件：

```shell
git reset HEAD <file>
```

撤回所有已添加到暂存区的文件：

```shell
git reset HEAD .
```

## **2. 撤回上一次的提交（未推送到远程仓库）**

### **a. 修改最后一次提交**

修改上一次提交的提交信息或添加/删除文件：

```shell
git commit --amend
```

### **b. 撤销最后一次提交并保留更改**

撤销最后一次提交并保留更改在暂存区：

***\*Bash\*******\*：\****git reset --soft HEAD~1

撤销最后一次提交并保留更改在工作区：

***\*Bash\*******\*：\****git reset --mixed HEAD~1

### **c. 撤销最后一次提交并丢弃更改**

撤销最后一次提交并删除所有更改：

***\*Bash\*******\*：\****git reset --hard HEAD~1

## **3. 撤回已经推送到远程仓库的提交**

### **a. 回滚到之前的提交并强制推送**

**注意：** 此操作会修改项目历史，可能导致其他人的问题，谨慎使用。

***\*Bash\*******\*：\****git reset --hard HEAD~1

git push --force

### **b. 使用** revert **创建一个新的撤销提交**

生成一个新的提交，用于撤销之前的更改，而不修改历史记录：

***\*Bash\*******\*：\****git revert <commit>

撤销上一次提交：

***\*Bash\*******\*：\****git revert HEAD

## **4. 撤回多个提交**

### **a. 回滚多个提交并丢弃更改**

回滚最近的三次提交并删除所有更改：

***\*Bash\*******\*：\****git reset --hard HEAD~3

### **b. 使用** revert **撤回多个提交**

指定多个提交并生成撤销提交：

***\*Bash\*******\*：\****git revert <commit1> <commit2> <commit3>

#  **常见问题**

## 1.gitignore未能忽视或过滤一些不必要的文件

例如：你已经在 .gitignore 文件中正确地添加了 *.pro.user 规则，但这些文件仍然被提交到 Git 仓库，可能是因为它们在添加到 .gitignore 之前已经被 Git 跟踪了。在这种情况下，.gitignore 不会影响已经被跟踪的文件。

***\*解决方案\****：

1. **在该项目目录下打开gitbash 终端输入**：`git ls-files` 命令，列出所有已经被 Git 跟踪的文件。(就可以发现哪些放在.gitignore中但未生效的文件)
2. **输入**：`git rm --cached *.pro.user`将这些已被跟踪的文件从 Git 缓存中移除，但不删除本地文件。(OK解决)
3. **执行**：`git status` 就可以看到*.pro.user这种文件不在更改中。
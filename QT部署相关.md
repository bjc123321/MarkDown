# Qt打包项目步骤(win10/win11)

## 一、Qt程序发布release

Qt软件软件运行有debug和release模式，debug模式包含调试信息，日常写项目、调试BUG都是在debug模式下，这对开发者而言很友好，但是随之而来的是占用较大的内存，具有较慢的运行的速度，不适合非开发人员使用。release模式下只进行项目本身要求功能的编译运行，不能调试，但使用内存小、运行速度快发布release需要将**构建配置选为release**。

如：一个项目以Debug模式完成开发后，想要部署再其他电脑上使用开发的项目，首先在QT Creator上选择Release之后点击**小锤子**构建。之后等待QT自己构建，构建运行测试无误后，找到程序文件下的release文件夹，拷贝.exe文件至另外的自定义的文件夹（为了方便打包，避免与一堆编译后的文件混杂），如在自定义的文件夹路径， D:\30kwPackage

![](D:\TechDoc\markdown\images2\complie_release.png)

## 二、使用Qt打包软件自动打包程序

软件运行需要众多的动态链接库和外部文件支持，由于Qt安装时Qt软件会自动配置好Qt自身所需要的库即dll文件，开发者们只需要配置项目需要的外部库文件，如sqlite3.dll、coin3d.dll等，都是需要开发者们自己去寻找配置的。对软件使用者而言，使用一个软件只需要安装完双击.exe文件就行，如果还需要另外安装Qt、VS等才能运行软件，那只能说这个项目开发极不成功。

正常项目开发完结束，需要把项目从代码文件打包成为可执行程序文件（.exe），而.exe文件运行需要外部库支持，为了不多装多余软件，需要把.exe运行所需要的库文件拷贝至发布文件夹内，Qt自带的打包软件会将.exe需要的Qt库文件全找到并拷贝至发布文件夹，但是无法找到非Qt的库文件，如数据库、opencv等库。Qt打包方法如下：

1. 在开始软件菜单里找到Qt文件夹，运行文件夹的cmd程序Qt 5.7 for Desktop (MinGW 5.3.0 32 bit)，以**管理员**方式打开

   ### ![](D:\TechDoc\markdown\images2\mingw.png)

2. 然后输入windeployqt name.exe --force，name是可执行文件的名称（注：--force 的作用是强制覆盖目标目录中已经存在的文件。如果你之前已经运行过 `windeployqt` 并且目标目录中已有一些文件，使用 `--force` 会覆盖这些文件，确保部署过程中包含最新的依赖项和文件。这在更新应用程序或修复部署问题时特别有用。）

   ![](D:\TechDoc\markdown\images2\windeployqt.png)

进行到这一步，项目所需要的Qt库文件都拷贝结束，接着把项目用到的外部文件拷贝至发布文件夹，如软件运行需要的数据库文件、图标文件和其他文件。

**如果项目很小而且只用Qt没用其他的外部库，到这一步就已经结束了**，这时可以双击发布文件夹内的.exe文件测试运行

## 三、添加外部库文件（dll）

规模比较大的项目常常使用很多的外部库来支持运行，项目打包需要拷贝这些外部库的dll文件，然而有时候项目到底用了外部库的哪个模块开发人员可能也不清楚，再加上找这些库文件也不容易，这时候需要用外部软件**dependencies**查询.exe需要的外部库文件。

1. 下载网址：https://github.com/lucasg/Dependencies。我们要下载**Release版**的依赖分析工具：Dependencies_x64_Release.zip（**注意64位和32位要选好，不然后面会有坑！！！）**。无需安装，解压即可，运行文件夹里的DependenciesGUI.exe（用图形化的更方便易懂），在依赖分析工具软件内打开发布文件夹内的EXE文件，就会自动分析依赖。
2. 打开后左侧边栏会显示EXE文件所需要的DLL文件，发布文件夹内没有的会标红，标红的文件需要自己去电脑上寻找，以图中的sqlite3.dll文件为例，该DLL文件是在我装MySQL的软件内，如果知道DLL是哪个外部库，就直接去该外部库路径下寻找吧。
3. **注意1**： 处理完标红的问题文件，程序肯定能脱离Qt而在你的电脑上独立的运行，但是如果要把这个程序给其他人使用，还有一些工作要做，在上图中显示的程序使用到的DLL文件有的在发布文件夹能找到，有的则是在在系统C盘里，还有一些是在我安装Qt的文件夹里，系统C盘的DLL可能别人电脑里也有，但是为了防止别人没有，最好是也把这些DLL找到，复制到发布文件夹内。而在安装Qt的文件夹里找到的DLL，别人的电脑上是肯定没有的，必须要复制到发布文件夹内
4. **注意2**：还有一种数据库文件、配置文件的情况，需要单独添加比如根据代码中查找外部文件的路径添加（代码中查找**配置文件**和**数据库**等外部文件时尽量写相对目录不要写绝对目录）

![](D:\TechDoc\markdown\images2\dependencies.png)

至此，一个QT程序的部署就完成了，你可以将你开发的QT程序打包给别人使用。